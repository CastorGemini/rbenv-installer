#!/usr/bin/env bash
# Summary: Install as a rbenv plugin the repository ($1) of the github user ($2).
#
# Usage: rbenv plugin <github_user>:<github_repo>
#        rbenv plugins <github_user_a>:<github_repo_a> <github_user_b>:<github_repo_b> ...
#
# Installs the Github user's repository master branch as the rbenv plugin.
# The GitHub repository name is used as the rbenv plugin name.

set -e
[ -n "$RBENV_DEBUG" ] && set -x

if [ -z "${RBENV_ROOT}" ]; then
  RBENV_ROOT="$HOME/.rbenv"
fi

# Install plugins:
PLUGINS=("$@")

for plugin in ${PLUGINS[@]} ; do

  KEY=${plugin%%:*}
  VALUE=${plugin#*:}

  RBENV_PLUGIN_ROOT="${RBENV_ROOT}/plugins/$VALUE"
  if [ ! -d "$RBENV_PLUGIN_ROOT" ] ; then
    # Keep downloads lean and installs fast - grab ONLY the branch we need.
    BRANCH=master
    mkdir -p $RBENV_PLUGIN_ROOT
    cd $RBENV_PLUGIN_ROOT
    git init
    git remote add -t $BRANCH origin https://github.com/$KEY/$VALUE.git
    git checkout $BRANCH
  else
    cd $RBENV_PLUGIN_ROOT
    echo "Pulling $VALUE updates."
    git pull
  fi

done
